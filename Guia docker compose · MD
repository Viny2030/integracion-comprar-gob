# ğŸ³ GuÃ­a de Uso - Docker Compose con Scraper

## ğŸ“‹ Comandos principales

### **Iniciar solo el dashboard (uso normal):**
```powershell
docker-compose up -d
```
- Inicia el dashboard en http://localhost:8501
- El scraper NO se ejecuta automÃ¡ticamente

### **Ejecutar el scraper (cuando necesites generar reportes):**
```powershell
docker-compose run --rm scraper
```
- Ejecuta `diario.py` una sola vez
- Genera el reporte del dÃ­a
- Se guarda en `data/YYYY-MM/`
- El contenedor se elimina automÃ¡ticamente al terminar (`--rm`)

### **Ver logs del scraper mientras corre:**
```powershell
docker-compose run scraper
# (sin --rm para ver los logs completos)
```

### **Detener todo:**
```powershell
docker-compose down
```

---

## ğŸ”„ Flujo de trabajo diario

### **OpciÃ³n A: Ejecutar manualmente cuando quieras**
```powershell
# Por la maÃ±ana, ejecutas:
docker-compose run --rm scraper

# El dashboard sigue corriendo, solo refresca la pÃ¡gina para ver los nuevos datos
```

### **OpciÃ³n B: Automatizar con Task Scheduler (Windows)**

1. Abrir "Programador de tareas" (Task Scheduler)
2. Crear tarea bÃ¡sica
3. Nombre: "Monitor Scraper Diario"
4. Disparador: Diariamente a las 9:00 AM
5. AcciÃ³n: Iniciar un programa
   - Programa: `powershell.exe`
   - Argumentos: `-Command "cd C:\Users\ASUS\PycharmProjects\integracion-comprar-gob-NUEVO; docker-compose run --rm scraper"`

---

## ğŸ“Š Estructura despuÃ©s de la migraciÃ³n

```
proyecto/
â”œâ”€â”€ docker-compose.yml          â† NUEVO (reemplazar)
â”œâ”€â”€ Dockerfile                  (sin cambios)
â”œâ”€â”€ diario.py                   â† NUEVO (reemplazar)
â”œâ”€â”€ dashboard.py                â† NUEVO (reemplazar)
â”œâ”€â”€ analisis.py                 (sin cambios)
â””â”€â”€ data/
    â”œâ”€â”€ 2026-01/               â† Crear este fin de semana
    â”‚   â””â”€â”€ reporte_fenomenos_202601*.xlsx
    â””â”€â”€ 2026-02/               â† Se crearÃ¡ automÃ¡ticamente el lunes
        â””â”€â”€ (reportes de febrero)
```

---

## ğŸš€ Pasos de implementaciÃ³n este fin de semana

### **1. Backup:**
```powershell
# Hacer copia de seguridad
xcopy data data_backup\ /E /I
```

### **2. Migrar enero:**
```powershell
# Crear carpeta
mkdir data\2026-01

# Mover reportes de enero
move data\reporte_fenomenos_202601*.xlsx data\2026-01\
```

### **3. Actualizar archivos:**
- Reemplazar `docker-compose.yml`
- Reemplazar `diario.py`
- Reemplazar `dashboard.py`

### **4. Reconstruir contenedores:**
```powershell
# Detener todo
docker-compose down

# Eliminar contenedor viejo (opcional, para limpieza)
docker rm monitor_integracion

# Reconstruir con nueva configuraciÃ³n
docker-compose build

# Iniciar dashboard
docker-compose up -d
```

### **5. Verificar dashboard:**
- Abrir http://localhost:8501
- Verificar que aparece selector de mes
- Verificar que puedes ver reportes de enero

### **6. Probar el scraper:**
```powershell
# Ejecutar una prueba
docker-compose run --rm scraper

# Verificar que funcionÃ³
ls data\2026-01\
```

---

## âœ… Ventajas de esta configuraciÃ³n

âœ… **Dashboard siempre disponible** - Corre 24/7
âœ… **Scraper bajo demanda** - Solo cuando lo necesitas
âœ… **Sin conflictos** - Servicios separados
âœ… **FÃ¡cil de automatizar** - Con Task Scheduler
âœ… **Logs claros** - Cada servicio tiene sus propios logs
âœ… **Ahorro de recursos** - El scraper solo corre cuando es necesario

---

## ğŸ” Troubleshooting

### **Error: "no configuration file provided"**
Verifica que estÃ¡s en la carpeta correcta:
```powershell
cd C:\Users\ASUS\PycharmProjects\integracion-comprar-gob-NUEVO
docker-compose up -d
```

### **Dashboard no muestra nuevos datos**
Refresca el navegador (Ctrl + F5)

### **Scraper no genera reporte**
Ver logs:
```powershell
docker-compose run scraper
# (sin --rm para ver todos los logs)
```

### **Volumen no monta correctamente**
Verificar permisos de la carpeta `data/`:
```powershell
icacls data /grant Everyone:F
```

---

## ğŸ“… A partir del lunes 3 de febrero

### **Ejecutar diariamente:**
```powershell
docker-compose run --rm scraper
```

### **O automatizar con Task Scheduler** (recomendado)

### **El dashboard se actualiza automÃ¡ticamente**
Solo refrescar la pÃ¡gina en el navegador

---

## ğŸ“ Comandos Ãºtiles adicionales

```powershell
# Ver logs del dashboard
docker-compose logs -f dashboard

# Ver todos los contenedores
docker-compose ps

# Reiniciar solo el dashboard
docker-compose restart dashboard

# Reconstruir sin usar cachÃ©
docker-compose build --no-cache

# Eliminar todo (contenedores, redes, volÃºmenes)
docker-compose down -v
```